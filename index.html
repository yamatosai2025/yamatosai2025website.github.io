<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>山東祭2025｜E。-ast-</title>
    
    <meta name="description" content="山東祭2025の公式ウェブサイトへようこそ！開催日時、イベントスケジュール、模擬店や展示の情報をリアルタイムで更新中。宇宙をテーマにした今年の文化祭をお見逃しなく！">
    
    <link rel="icon" type="image/png" href="favicon.png">
    
    <!-- Google Fonts & Font Awesome (Preconnect) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- クリティカルCSSをインライン化 -->
    <style>
        :root {
            --bg-color: #1a1a3b;
            --text-color: #f0f0f0;
            --accent-color: #d1bfff;
            --card-bg: rgba(0, 0, 0, 0.3);
            --border-color: rgba(255, 255, 255, 0.1);
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            overflow-x: hidden;
            margin: 0;
        }
        .font-playfair { font-family: 'Playfair Display', serif; }
        @keyframes gradient-animation {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.5; text-shadow: 0 0 5px var(--accent-color); }
            50% { opacity: 1; text-shadow: 0 0 15px var(--accent-color); }
        }
        #preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); z-index: 9999; display: flex; align-items: center; justify-content: center; transition: opacity 0.8s ease, visibility 0.8s ease; }
        #preloader .loader-text { color: var(--accent-color); font-size: 2rem; font-family: 'Playfair Display', serif; animation: pulse 2s infinite; }
        #starry-sky { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        header { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; position: relative; padding: 1rem; }
        header h1 { font-size: 3rem; font-weight: 900; margin-bottom: 1rem; line-height: 1.2; }
        header p { font-size: 1.125rem; color: #d1d5db; }
        .galaxy-text { background: linear-gradient(45deg, #d1bfff, #a29bfe, #74b9ff, #d1bfff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent; animation: gradient-animation 5s ease infinite; background-size: 200% 200%; }
        .scroll-down-arrow { position: absolute; bottom: 2.5rem; left: 50%; transform: translateX(-50%); animation: bounce 2s infinite; color: var(--accent-color); font-size: 1.875rem; }
        #lang-switcher-container { position: fixed; top: 1.25rem; right: 1.25rem; z-index: 50; }
        #lang-switcher-btn { padding: 0.5rem 1rem; color: white; background-color: var(--card-bg); backdrop-filter: blur(5px); border: 1px solid var(--border-color); border-radius: 9999px; transition: all 0.3s; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; }
        #lang-switcher-btn:hover { background-color: rgba(255, 255, 255, 0.2); }
        @media (min-width: 768px) {
            header h1 { font-size: 5rem; }
            header p { font-size: 1.5rem; }
        }
    </style>
    
    <!-- 非クリティカルCSS & フォントを非同期で読み込み -->
    <link rel="preload" href="style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="style.css"></noscript>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&family=Playfair+Display:wght@700;900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&family=Playfair+Display:wght@700;900&display=swap"></noscript>
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
</head>
<body>

    <canvas id="starry-sky"></canvas>
    <div id="preloader"><div class="loader-text">E . - a s t -</div></div>
    
    <div id="lang-switcher-container">
        <button id="lang-switcher-btn">
            <i class="fas fa-globe"></i>
            <span id="lang-switcher-text">English</span>
        </button>
    </div>

    <div id="mapModal" class="modal">
        <span class="modal-close" id="closeModal">&times;</span>
        <img class="modal-content" id="modalImage" src="" onerror="this.onerror=null;this.src='https://placehold.co/1200x800/1a1a3b/d1bfff?text=Map+Error';">
    </div>

    <header>
        <div>
            <h1 class="font-playfair galaxy-text" data-lang-key="heroTitle">山東祭2025<br>E-AST-</h1>
            <p class="font-playfair" data-lang-key="heroSubtitle">スローガン：『チ。-地球の運動について-』</p>
        </div>
        <a href="#info" class="scroll-down-arrow"><i class="fas fa-chevron-down"></i></a>
    </header>

    <main>
        <section id="info" class="fade-in-section">
            <h2 class="font-playfair section-title" data-lang-key="infoTitle">Information</h2>
            <div class="grid md-grid-cols-2">
                <!-- ★ 修正点: 背景画像をUnsplashの最適化URLに変更 -->
                <div class="info-card floating-card" style="background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=800&auto=format&fit=crop&fm=webp');">
                    <h3 class="font-playfair" data-lang-key="infoDateTitle">日程</h3>
                    <p data-lang-key="infoDate1">8月30日 (土)</p>
                    <p data-lang-key="infoDate2">8月31日 (日)</p>
                </div>
                <!-- ★ 修正点: 背景画像をUnsplashの最適化URLに変更 -->
                <div class="info-card floating-card" style="background-image: url('https://images.unsplash.com/photo-1506443432602-ac2fcd6f54e0?q=80&w=800&auto=format&fit=crop&fm=webp');">
                    <h3 class="font-playfair" data-lang-key="infoTimeTitle">一般公開 時間</h3>
                    <p data-lang-key="infoTime1">8/30 (土) 10:30 〜 15:00</p>
                    <p data-lang-key="infoTime2">8/31 (日) 10:00 〜 14:00</p>
                </div>
            </div>
        </section>

        <section id="schedule" class="fade-in-section">
            <h2 class="font-playfair section-title" data-lang-key="scheduleTitle">Schedule</h2>
            <div>
                <div class="tab-buttons" id="date-tabs">
                    <button data-date-target="day1" class="tab-active" data-lang-key="scheduleDate1">8月30日(土)</button>
                    <button data-date-target="day2" data-lang-key="scheduleDate2">8月31日(日)</button>
                </div>
                <div id="schedule-content-container">
                    <div id="day1" class="date-content">
                        <h3 class="font-playfair" style="text-align: center; margin-bottom: 2rem; color: #d1d5db;" data-lang-key="scheduleDay1Title">8/30 (Sat)</h3>
                        <div class="grid md-grid-cols-2">
                            <div class="schedule-card">
                                <h4 class="font-playfair" data-lang-key="scheduleVenueGym">体育館</h4>
                                <div class="space-y-6">
                                    <div class="schedule-item"><time>10:30~10:35</time><div data-lang-key="eventD1G1">オープニング</div></div>
                                    <div class="schedule-item"><time>10:35~11:30</time><div data-lang-key="eventD1G2">放送部作品上映</div></div>
                                    <div class="schedule-item"><time>11:30~12:00</time><div data-lang-key="eventD1G3">歌うまAブロック</div></div>
                                    <div class="schedule-item"><time>12:05~12:45</time><div data-lang-key="eventD1G4">一年生ダンス</div></div>
                                    <div class="schedule-item"><time>12:50~13:10</time><div data-lang-key="eventD1G5">チアパフォーマンス</div></div>
                                    <div class="schedule-item"><time>13:15~13:45</time><div data-lang-key="eventD1G6">歌うまBブロック</div></div>
                                    <div class="schedule-item"><time>13:50~14:20</time><div data-lang-key="eventD1G7">イントロドン</div></div>
                                    <div class="schedule-item"><time>14:25~14:55</time><div data-lang-key="eventD1G8">有志ダンス</div></div>
                                </div>
                            </div>
                            <div class="schedule-card" style="display:flex; align-items:center; justify-content:center;">
                                 <p style="text-align:center; color: #9ca3af;" data-lang-key="eventD1A_none">講堂での一般公開企画はありません</p>
                            </div>
                        </div>
                    </div>
                    <div id="day2" class="date-content hidden">
                        <h3 class="font-playfair" style="text-align: center; margin-bottom: 2rem; color: #d1d5db;" data-lang-key="scheduleDay2Title">8/31 (Sun)</h3>
                        <div class="grid md-grid-cols-2">
                            <div class="schedule-card">
                                <h4 class="font-playfair" data-lang-key="scheduleVenueGym">体育館</h4>
                                <div class="space-y-6">
                                    <div class="schedule-item"><time>10:10~10:40</time><div data-lang-key="eventD2G1">歌うまCブロック</div></div>
                                    <div class="schedule-item"><time>10:45~11:30</time><div data-lang-key="eventD2G2">H-1グランプリ</div></div>
                                    <div class="schedule-item"><time>11:35~12:15</time><div data-lang-key="eventD2G3">一年生ダンス</div></div>
                                    <div class="schedule-item"><time>12:20~13:05</time><div data-lang-key="eventD2G4">有志ダンス</div></div>
                                    <div class="schedule-item"><time>13:10~13:40</time><div data-lang-key="eventD2G5">書道パフォーマンス</div></div>
                                    <div class="schedule-item"><time>13:45~13:50</time><div data-lang-key="eventD2G6">エンディング</div></div>
                                </div>
                            </div>
                            <div class="schedule-card">
                                <h4 class="font-playfair" data-lang-key="scheduleVenueHall">講堂</h4>
                                <div class="space-y-6">
                                    <div class="schedule-item"><time>10:10~11:00</time><div data-lang-key="eventD2A1">スマブラ大会</div></div>
                                    <div class="schedule-item"><time>11:05~11:20</time><div data-lang-key="eventD2A2">歌うま準決勝</div></div>
                                    <div class="schedule-item"><time>11:30~14:05</time><div data-lang-key="eventD2A3">バンド</div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="booths" class="fade-in-section">
            <h2 class="font-playfair section-title" data-lang-key="boothsTitle">Booths & Exhibits</h2>
            <div id="filters">
                <button class="filter-active" data-filter="all" data-lang-key="filterAll">すべて</button>
                <button data-filter="class" data-lang-key="filterClass">クラス</button>
                <button data-filter="club" data-lang-key="filterClub">部活・委員会</button>
            </div>
            <div id="booth-grid" class="grid grid-cols-1 md-grid-cols-2 lg-grid-cols-3"></div>
            <div style="text-align: center; margin-top: 3rem;">
                <a href="https://drive.google.com/drive/folders/1g72cGElfsPMMzFcXUasVw_DdJJnD_Eql" target="_blank" rel="noopener noreferrer" class="cta-button" data-lang-key="researchPostersButton">
                    <i class="fas fa-search" style="margin-right: 0.5rem;"></i>本校2年生の探究ポスターはこちら
                </a>
            </div>
        </section>

        <section id="crowd-status" class="fade-in-section">
            <h2 class="font-playfair section-title" data-lang-key="crowdTitle">リアルタイム混雑状況</h2>
            <div id="crowd-status-grid" class="grid grid-cols-1 md-grid-cols-2 lg-grid-cols-3">
                <p style="grid-column: 1 / -1; text-align: center; color: #9ca3af;" data-lang-key="crowdLoading">混雑状況を読み込んでいます...</p>
            </div>
        </section>

        <section id="map" class="fade-in-section">
            <h2 class="font-playfair section-title" data-lang-key="mapTitle">School Map</h2>
            <div class="map-container">
                <div class="tab-buttons" id="map-tabs">
                    <button class="tab-active" data-map-target="map-1f" data-lang-key="mapTab1F">1F</button>
                    <button data-map-target="map-2f" data-lang-key="mapTab2F">2F</button>
                    <button data-map-target="map-3f" data-lang-key="mapTab3F">3F</button>
                    <button data-map-target="map-gym" data-lang-key="mapTabGym">体育館</button>
                </div>
                <div id="map-images">
                    <img id="map-1f" class="map-image" src="山東祭校内マップ1F.svg" alt="1階 校内マップ" onerror="this.onerror=null;this.src='https://placehold.co/1000x600/1a1a3b/d1bfff?text=Map+1F+Error';">
                    <img id="map-2f" class="map-image hidden" src="山東祭校内マップ2F.svg" alt="2階 校内マップ" onerror="this.onerror=null;this.src='https://placehold.co/1000x600/1a1a3b/d1bfff?text=Map+2F+Error';">
                    <img id="map-3f" class="map-image hidden" src="山東祭校内マップ3F.svg" alt="3階 校内マップ" onerror="this.onerror=null;this.src='https://placehold.co/1000x600/1a1a3b/d1bfff?text=Map+3F+Error';">
                    <img id="map-gym" class="map-image hidden" src="山東祭校内マップ体育館.svg" alt="体育館マップ" onerror="this.onerror=null;this.src='https://placehold.co/1000x600/1a1a3b/d1bfff?text=Map+Gym+Error';">
                </div>
                <p style="text-align: center; margin-top: 1rem; color: #9ca3af;" data-lang-key="mapDesc">マップをクリックまたはタップで拡大表示します。</p>
            </div>
        </section>

        <section id="access" class="fade-in-section">
            <h2 class="font-playfair section-title" data-lang-key="accessTitle">Access</h2>
            <div class="grid lg-grid-cols-2">
                <div class="info-card">
                    <h3 class="font-playfair" data-lang-key="accessSchoolName">山形県立山形東高等学校</h3>
                    <p><i class="fas fa-map-marker-alt" style="width: 1.5rem;"></i> <span data-lang-key="accessAddressTitle">住所:</span> <span data-lang-key="accessAddress">〒990-0044 山形県山形市緑町1-5-59</span></p>
                    <p style="margin-top: 0.5rem;"><i class="fas fa-phone" style="width: 1.5rem;"></i> <span data-lang-key="accessPhoneTitle">電話:</span> 023-622-3010</p>
                </div>
                <div class="info-card" style="display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                    <i class="fas fa-map-marked-alt" style="font-size: 2.25rem; color: var(--accent-color); margin-bottom: 1rem;"></i>
                    <h3 class="font-playfair" style="font-size: 1.25rem; margin-bottom: 1rem;" data-lang-key="accessGmapTitle">地図で場所を確認</h3>
                    <a href="https://www.google.com/maps/place/%E5%B1%B1%E5%BD%A2%E7%9C%8C%E7%AB%8B%E5%B1%B1%E5%BD%A2%E6%9D%B1%E9%AB%98%E7%AD%89%E5%AD%A6%E6%A0%A1" target="_blank" rel="noopener noreferrer" class="cta-button" data-lang-key="accessGmapButton">
                        Googleマップで開く
                    </a>
               </div>
            </div>
        </section>

        <section class="fade-in-section" style="text-align: center;">
             <a href="https://www.instagram.com/yamatosai_2025" target="_blank" rel="noopener noreferrer" class="cta-button" data-lang-key="instagramButton">
                <i class="fab fa-instagram" style="margin-right: 0.5rem;"></i>
                山東祭 公式Instagramへ
            </a>
        </section>
    </main>

    <footer>
        <div class="footer-stars"></div>
        <p data-lang-key="footerText">© 2025 山形東高校 山東祭実行委員会</p>
    </footer>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
             apiKey: "AIzaSyBUclBluehOXOZXlDCeePcdVKmYdKkRxFI",
             authDomain: "yamatosai2025-4f10b.firebaseapp.com",
             projectId: "yamatosai2025-4f10b",
             storageBucket: "yamatosai2025-4f10b.firebasestorage.app",
             messagingSenderId: "817983089763",
             appId: "1:817983089763:web:8ca71d1ff70812f2645c56",
             measurementId: "G-H7VH1ZJYE9"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            
            signInAnonymously(auth).catch(console.error);

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    const dbPath = `/artifacts/${firebaseConfig.projectId}/public/data/crowd-status`;
                    onSnapshot(collection(db, dbPath), (snapshot) => {
                        const statuses = {};
                        snapshot.forEach((doc) => { statuses[doc.id] = doc.data(); });
                        window.updateCrowdStatusUI(statuses);
                    }, console.error);
                }
            });
        } catch (error) {
            console.error("Firebase initialization failed:", error);
            const crowdGrid = document.getElementById('crowd-status-grid');
            if(crowdGrid) {
                crowdGrid.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; color: #9ca3af;">混雑状況の取得に失敗しました。</p>`;
            }
        }
    </script>

    <!-- JavaScriptを遅延実行 -->
    <script src="script.js" defer></script>
</body>
</html>
